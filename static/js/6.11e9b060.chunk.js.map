{"version":3,"sources":["components/proposals/SubmitAction.tsx","components/proposals/SponsorAction.tsx","components/proposals/ProcessAction.tsx","components/proposals/ProcessActionMembership.tsx","components/proposals/ProcessActionTribute.tsx","components/proposals/PostProcessAction.tsx","components/proposals/ProposalWithOffchainVoteActions.tsx"],"names":["SubmitAction","props","proposal","snapshotDraft","refetchProposalOrDraft","useState","submitError","setSubmitError","contracts","useSelector","s","daoRegistryAddress","DaoRegistryContract","contractAddress","useWeb3Modal","account","web3Instance","useContractSend","txEtherscanURL","txIsPromptOpen","txSend","txStatus","useMemberActionDisabled","isDisabled","openWhyDisabledModal","WhyDisabledModal","useSignAndSubmitProposal","proposalSignAndSendStatus","signAndSendProposal","gasPrices","useETHGasPrice","isInProcess","Web3TxStatus","AWAITING_CONFIRM","PENDING","isDone","FULFILLED","isInProcessOrDone","a","Error","contract","getContractByAddress","actionId","msg","payload","name","body","metadata","timestamp","partialProposalData","adapterAddress","type","SnapshotType","data","signature","preparedVoteVerificationBytes","prepareVoteProposalData","choices","snapshot","toString","start","end","sig","space","parseInt","submitArguments","idInDAO","submitActionArgs","txArguments","from","gasPrice","fast","instance","methods","className","disabled","onClick","Loader","ErrorMessageWithDetails","error","renderText","CycleMessage","intervalMs","messages","TX_CYCLE_MESSAGES","useFirstItemStart","render","message","FadeIn","EtherscanURL","url","isPending","renderSubmitStatus","title","SponsorAction","sponsorArguments","useMemberActionDisabledProps","skipIsActiveMemberCheck","ProcessAction","propsDisabled","snapshotProposal","areSomeDisabled","processArguments","ProcessActionMembership","isProposalPassed","membershipProposalAmount","setMembershipProposalAmount","actionDisabledReasonsRef","useRef","notProposerMessage","OnboardingContract","state","setOtherDisabledReasons","getMembershipProposalAmountCached","useCallback","proposals","call","proposalDetails","amount","console","undefined","value","useEffect","accountAuthorizedToProcessPassedProposal","current","toLowerCase","Object","values","ProcessActionTribute","tributeProposalDetails","setTributeProposalDetails","TributeContract","txEtherscanURLTokenApprove","txIsPromptOpenTokenApprove","txSendTokenApprove","txStatusTokenApprove","getTributeProposalDetailsCached","tokenAddress","token","tributeAmount","handleSubmitTokenApprove","lazyERC20ABI","default","erc20Contract","erc20Instance","eth","Contract","allowance","tributeAmountBN","toBN","allowanceBN","gt","difference","sub","approveValue","add","tokenApproveArguments","PostProcessAction","adapterName","alreadyCompletedMessage","daoRegistryContract","getSubmitConfigsByAdapter","ContractAdapterNames","distribute","toIndexArg","isTypeAllMembers","getNbMembers","nbMembers","functionName","functionArguments","renderSubmitStatusByAdapter","renderButtonTextByAdapter","done","distributeContract","distributions","distributeProposal","DistributionStatus","status","IN_PROGRESS","getActionDisabledReasons","ProposalWithOffchainVoteActions","useProposalWithOffchainVoteStatus","daoProposalVotes","daoProposalVoteResult","gracePeriodStartMs","ProposalFlowStatus","OffchainVotingGracePeriod","Number","gracePeriodStartingTime","showPostProcessAction","Completed","VotingState","PASS","OffchainVoting","OffchainVotingSubmitResult","Process","countdownGracePeriodStartMs","Submit","Sponsor","onboarding","tribute","renderProcessAction"],"mappings":"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","file":"static/js/6.11e9b060.chunk.js","sourcesContent":["import React, {useState} from 'react';\nimport {useSelector} from 'react-redux';\n\nimport {\n  prepareVoteProposalData,\n  SnapshotType,\n} from '@openlaw/snapshot-js-erc712';\nimport {getContractByAddress} from '../web3/helpers';\nimport {ProposalData} from './types';\nimport {StoreState} from '../../store/types';\nimport {TX_CYCLE_MESSAGES} from '../web3/config';\nimport {useContractSend, useETHGasPrice, useWeb3Modal} from '../web3/hooks';\nimport {useMemberActionDisabled} from '../../hooks';\nimport {useSignAndSubmitProposal} from './hooks';\nimport {Web3TxStatus} from '../web3/types';\nimport CycleMessage from '../feedback/CycleMessage';\nimport ErrorMessageWithDetails from '../common/ErrorMessageWithDetails';\nimport EtherscanURL from '../web3/EtherscanURL';\nimport FadeIn from '../common/FadeIn';\nimport Loader from '../feedback/Loader';\n\ntype SubmitArguments = [\n  string, // `dao`\n  string, // `proposalId`\n  ...any[],\n  string // `proposal data`\n];\n\ntype SubmitActionProps = {\n  proposal: ProposalData;\n};\n\nexport default function SubmitAction(props: SubmitActionProps) {\n  const {\n    proposal: {snapshotDraft, refetchProposalOrDraft},\n  } = props;\n\n  /**\n   * State\n   */\n\n  const [submitError, setSubmitError] = useState<Error>();\n\n  /**\n   * Selectors\n   */\n\n  const contracts = useSelector((s: StoreState) => s.contracts);\n  const daoRegistryAddress = useSelector(\n    (s: StoreState) => s.contracts.DaoRegistryContract?.contractAddress\n  );\n\n  /**\n   * Our hooks\n   */\n\n  const {account, web3Instance} = useWeb3Modal();\n\n  const {txEtherscanURL, txIsPromptOpen, txSend, txStatus} = useContractSend();\n\n  const {\n    isDisabled,\n    openWhyDisabledModal,\n    WhyDisabledModal,\n  } = useMemberActionDisabled();\n\n  const {\n    proposalSignAndSendStatus,\n    signAndSendProposal,\n  } = useSignAndSubmitProposal<SnapshotType.proposal>();\n\n  const gasPrices = useETHGasPrice();\n\n  /**\n   * Variables\n   */\n\n  const isInProcess =\n    txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    txStatus === Web3TxStatus.PENDING ||\n    proposalSignAndSendStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    proposalSignAndSendStatus === Web3TxStatus.PENDING;\n\n  const isDone =\n    txStatus === Web3TxStatus.FULFILLED &&\n    proposalSignAndSendStatus === Web3TxStatus.FULFILLED;\n\n  const isInProcessOrDone = isInProcess || isDone || txIsPromptOpen;\n\n  /**\n   * Functions\n   */\n\n  async function handleSubmit() {\n    try {\n      if (!daoRegistryAddress) {\n        throw new Error('No DAO Registry address was found.');\n      }\n\n      if (!snapshotDraft) {\n        throw new Error('No Snapshot draft was found.');\n      }\n\n      const contract = getContractByAddress(snapshotDraft.actionId, contracts);\n\n      const {\n        msg: {\n          payload: {name, body, metadata},\n          timestamp,\n        },\n      } = snapshotDraft;\n\n      // Sign and submit draft for snapshot-hub\n      const {data, signature} = await signAndSendProposal({\n        partialProposalData: {\n          name,\n          body,\n          metadata,\n          timestamp,\n        },\n        adapterAddress: contract.contractAddress,\n        type: SnapshotType.proposal,\n      });\n\n      /**\n       * Prepare `data` argument for submission to DAO\n       *\n       * For information about which data the smart contract needs for signature verification (e.g. `hashMessage`):\n       * @link https://github.com/openlawteam/molochv3-contracts/blob/master/contracts/adapters/voting/OffchainVoting.sol\n       */\n      const preparedVoteVerificationBytes = prepareVoteProposalData(\n        {\n          payload: {\n            name: data.payload.name,\n            body: data.payload.body,\n            choices: data.payload.choices,\n            snapshot: data.payload.snapshot.toString(),\n            start: data.payload.start,\n            end: data.payload.end,\n          },\n          sig: signature,\n          space: data.space,\n          timestamp: parseInt(data.timestamp),\n        },\n        web3Instance\n      );\n\n      const submitArguments: SubmitArguments = [\n        daoRegistryAddress,\n        snapshotDraft.idInDAO,\n        ...(metadata.submitActionArgs || []),\n        preparedVoteVerificationBytes,\n      ];\n\n      const txArguments = {\n        from: account || '',\n        // Set a fast gas price\n        ...(gasPrices ? {gasPrice: gasPrices.fast} : null),\n      };\n\n      await txSend(\n        'submitProposal',\n        contract.instance.methods,\n        submitArguments,\n        txArguments\n      );\n\n      // Update the proposal\n      refetchProposalOrDraft();\n    } catch (error) {\n      setSubmitError(error);\n    }\n  }\n\n  /**\n   * Render\n   */\n\n  function renderSubmitStatus(): React.ReactNode {\n    // Either Snapshot or chain tx\n    if (\n      txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n      proposalSignAndSendStatus === Web3TxStatus.AWAITING_CONFIRM\n    ) {\n      return 'Awaiting your confirmation\\u2026';\n    }\n\n    // Only for chain tx\n    switch (txStatus) {\n      case Web3TxStatus.PENDING:\n        return (\n          <>\n            <CycleMessage\n              intervalMs={2000}\n              messages={TX_CYCLE_MESSAGES}\n              useFirstItemStart\n              render={(message) => {\n                return <FadeIn key={message}>{message}</FadeIn>;\n              }}\n            />\n\n            <EtherscanURL url={txEtherscanURL} isPending />\n          </>\n        );\n      case Web3TxStatus.FULFILLED:\n        return (\n          <>\n            <div>Proposal submitted!</div>\n\n            <EtherscanURL url={txEtherscanURL} />\n          </>\n        );\n      default:\n        return null;\n    }\n  }\n\n  return (\n    <>\n      <div>\n        <button\n          className=\"proposaldetails__button\"\n          disabled={isDisabled || isInProcessOrDone}\n          onClick={isDisabled || isInProcessOrDone ? () => {} : handleSubmit}>\n          {isInProcess ? <Loader /> : isDone ? 'Done' : 'Sponsor'}\n        </button>\n\n        <ErrorMessageWithDetails\n          error={submitError}\n          renderText=\"Something went wrong\"\n        />\n\n        {/* SUBMIT STATUS */}\n\n        {isInProcessOrDone && (\n          <div className=\"form__submit-status-container\">\n            {renderSubmitStatus()}\n          </div>\n        )}\n\n        {isDisabled && (\n          <button\n            className=\"button--help-centered\"\n            onClick={openWhyDisabledModal}>\n            Why is sponsoring disabled?\n          </button>\n        )}\n      </div>\n\n      <WhyDisabledModal title=\"Why is sponsoring disabled?\" />\n    </>\n  );\n}\n","import React, {useState} from 'react';\nimport {useSelector} from 'react-redux';\n\nimport {\n  prepareVoteProposalData,\n  SnapshotType,\n} from '@openlaw/snapshot-js-erc712';\nimport {getContractByAddress} from '../web3/helpers';\nimport {ProposalData} from './types';\nimport {StoreState} from '../../store/types';\nimport {TX_CYCLE_MESSAGES} from '../web3/config';\nimport {useContractSend, useETHGasPrice, useWeb3Modal} from '../web3/hooks';\nimport {useMemberActionDisabled} from '../../hooks';\nimport {useSignAndSubmitProposal} from './hooks';\nimport {Web3TxStatus} from '../web3/types';\nimport CycleMessage from '../feedback/CycleMessage';\nimport ErrorMessageWithDetails from '../common/ErrorMessageWithDetails';\nimport EtherscanURL from '../web3/EtherscanURL';\nimport FadeIn from '../common/FadeIn';\nimport Loader from '../feedback/Loader';\n\ntype SponsorArguments = [\n  string, // `dao`\n  string, // `proposalId`\n  string // `proposal data`\n];\n\ntype SponsorActionProps = {\n  proposal: ProposalData;\n};\n\nexport default function SponsorAction(props: SponsorActionProps) {\n  const {\n    proposal: {snapshotDraft, refetchProposalOrDraft},\n  } = props;\n\n  /**\n   * State\n   */\n\n  const [submitError, setSubmitError] = useState<Error>();\n\n  /**\n   * Selectors\n   */\n\n  const contracts = useSelector((s: StoreState) => s.contracts);\n  const daoRegistryAddress = useSelector(\n    (s: StoreState) => s.contracts.DaoRegistryContract?.contractAddress\n  );\n\n  /**\n   * Our hooks\n   */\n\n  const {account, web3Instance} = useWeb3Modal();\n\n  const {txEtherscanURL, txIsPromptOpen, txSend, txStatus} = useContractSend();\n\n  const {\n    isDisabled,\n    openWhyDisabledModal,\n    WhyDisabledModal,\n  } = useMemberActionDisabled();\n\n  const {\n    proposalSignAndSendStatus,\n    signAndSendProposal,\n  } = useSignAndSubmitProposal<SnapshotType.proposal>();\n\n  const gasPrices = useETHGasPrice();\n\n  /**\n   * Variables\n   */\n\n  const isInProcess =\n    txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    txStatus === Web3TxStatus.PENDING ||\n    proposalSignAndSendStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    proposalSignAndSendStatus === Web3TxStatus.PENDING;\n\n  const isDone =\n    txStatus === Web3TxStatus.FULFILLED &&\n    proposalSignAndSendStatus === Web3TxStatus.FULFILLED;\n\n  const isInProcessOrDone = isInProcess || isDone || txIsPromptOpen;\n\n  /**\n   * Functions\n   */\n\n  async function handleSubmit() {\n    try {\n      if (!daoRegistryAddress) {\n        throw new Error('No DAO Registry address was found.');\n      }\n\n      if (!snapshotDraft) {\n        throw new Error('No Snapshot draft was found.');\n      }\n\n      const contract = getContractByAddress(snapshotDraft.actionId, contracts);\n\n      const {\n        msg: {\n          payload: {name, body, metadata},\n          timestamp,\n        },\n      } = snapshotDraft;\n\n      // Sign and submit draft for snapshot-hub\n      const {data, signature} = await signAndSendProposal({\n        partialProposalData: {\n          name,\n          body,\n          metadata,\n          timestamp,\n        },\n        adapterAddress: contract.contractAddress,\n        type: SnapshotType.proposal,\n      });\n\n      /**\n       * Prepare `data` argument for submission to DAO\n       *\n       * For information about which data the smart contract needs for signature verification (e.g. `hashMessage`):\n       * @link https://github.com/openlawteam/molochv3-contracts/blob/master/contracts/adapters/voting/OffchainVoting.sol\n       */\n      const preparedVoteVerificationBytes = prepareVoteProposalData(\n        {\n          payload: {\n            name: data.payload.name,\n            body: data.payload.body,\n            choices: data.payload.choices,\n            snapshot: data.payload.snapshot.toString(),\n            start: data.payload.start,\n            end: data.payload.end,\n          },\n          sig: signature,\n          space: data.space,\n          timestamp: parseInt(data.timestamp),\n        },\n        web3Instance\n      );\n\n      const sponsorArguments: SponsorArguments = [\n        daoRegistryAddress,\n        snapshotDraft.idInDAO,\n        preparedVoteVerificationBytes,\n      ];\n\n      const txArguments = {\n        from: account || '',\n        // Set a fast gas price\n        ...(gasPrices ? {gasPrice: gasPrices.fast} : null),\n      };\n\n      await txSend(\n        'sponsorProposal',\n        contract.instance.methods,\n        sponsorArguments,\n        txArguments\n      );\n\n      // Update the proposal\n      refetchProposalOrDraft();\n    } catch (error) {\n      setSubmitError(error);\n    }\n  }\n\n  /**\n   * Render\n   */\n\n  function renderSubmitStatus(): React.ReactNode {\n    // Either Snapshot or chain tx\n    if (\n      txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n      proposalSignAndSendStatus === Web3TxStatus.AWAITING_CONFIRM\n    ) {\n      return 'Awaiting your confirmation\\u2026';\n    }\n\n    // Only for chain tx\n    switch (txStatus) {\n      case Web3TxStatus.PENDING:\n        return (\n          <>\n            <CycleMessage\n              intervalMs={2000}\n              messages={TX_CYCLE_MESSAGES}\n              useFirstItemStart\n              render={(message) => {\n                return <FadeIn key={message}>{message}</FadeIn>;\n              }}\n            />\n\n            <EtherscanURL url={txEtherscanURL} isPending />\n          </>\n        );\n      case Web3TxStatus.FULFILLED:\n        return (\n          <>\n            <div>Proposal submitted!</div>\n\n            <EtherscanURL url={txEtherscanURL} />\n          </>\n        );\n      default:\n        return null;\n    }\n  }\n\n  return (\n    <>\n      <div>\n        <button\n          className=\"proposaldetails__button\"\n          disabled={isDisabled || isInProcessOrDone}\n          onClick={isDisabled || isInProcessOrDone ? () => {} : handleSubmit}>\n          {isInProcess ? <Loader /> : isDone ? 'Done' : 'Sponsor'}\n        </button>\n\n        <ErrorMessageWithDetails\n          error={submitError}\n          renderText=\"Something went wrong\"\n        />\n\n        {/* SUBMIT STATUS */}\n\n        {isInProcessOrDone && (\n          <div className=\"form__submit-status-container\">\n            {renderSubmitStatus()}\n          </div>\n        )}\n\n        {isDisabled && (\n          <button\n            className=\"button--help-centered\"\n            onClick={openWhyDisabledModal}>\n            Why is sponsoring disabled?\n          </button>\n        )}\n      </div>\n\n      <WhyDisabledModal title=\"Why is sponsoring disabled?\" />\n    </>\n  );\n}\n","import {useState} from 'react';\nimport {useSelector} from 'react-redux';\n\nimport {CycleEllipsis} from '../feedback';\nimport {getContractByAddress} from '../web3/helpers';\nimport {ProposalData} from './types';\nimport {StoreState} from '../../store/types';\nimport {TX_CYCLE_MESSAGES} from '../web3/config';\nimport {useContractSend, useETHGasPrice, useWeb3Modal} from '../web3/hooks';\nimport {useMemberActionDisabled} from '../../hooks';\nimport {Web3TxStatus} from '../web3/types';\nimport CycleMessage from '../feedback/CycleMessage';\nimport ErrorMessageWithDetails from '../common/ErrorMessageWithDetails';\nimport EtherscanURL from '../web3/EtherscanURL';\nimport FadeIn from '../common/FadeIn';\nimport Loader from '../feedback/Loader';\n\ntype ProcessArguments = [\n  string, // `dao`\n  string // `proposalId`\n];\n\ntype ProcessActionProps = {\n  disabled?: boolean;\n  proposal: ProposalData;\n};\n\n/**\n * Cached outside the component to prevent infinite re-renders.\n *\n * The same can be accomplished inside the component using\n * `useState`, `useRef`, etc., depending on the use case.\n */\nconst useMemberActionDisabledProps = {\n  // Anyone can process a proposal - it's just a question of gas payment.\n  skipIsActiveMemberCheck: true,\n};\n\nexport default function ProcessAction(props: ProcessActionProps) {\n  const {\n    disabled: propsDisabled,\n    proposal: {snapshotProposal},\n  } = props;\n\n  /**\n   * State\n   */\n\n  const [submitError, setSubmitError] = useState<Error>();\n\n  /**\n   * Selectors\n   */\n\n  const contracts = useSelector((s: StoreState) => s.contracts);\n  const daoRegistryAddress = useSelector(\n    (s: StoreState) => s.contracts.DaoRegistryContract?.contractAddress\n  );\n\n  /**\n   * Our hooks\n   */\n\n  const {account} = useWeb3Modal();\n\n  const {txEtherscanURL, txIsPromptOpen, txSend, txStatus} = useContractSend();\n\n  const {\n    isDisabled,\n    openWhyDisabledModal,\n    WhyDisabledModal,\n  } = useMemberActionDisabled(useMemberActionDisabledProps);\n\n  const gasPrices = useETHGasPrice();\n\n  /**\n   * Variables\n   */\n\n  const isInProcess =\n    txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    txStatus === Web3TxStatus.PENDING;\n\n  const isDone = txStatus === Web3TxStatus.FULFILLED;\n  const isInProcessOrDone = isInProcess || isDone || txIsPromptOpen;\n  const areSomeDisabled = isDisabled || isInProcessOrDone || propsDisabled;\n\n  /**\n   * Functions\n   */\n\n  async function handleSubmit() {\n    try {\n      if (!daoRegistryAddress) {\n        throw new Error('No DAO Registry address was found.');\n      }\n\n      if (!snapshotProposal) {\n        throw new Error('No Snapshot proposal was found.');\n      }\n\n      const contract = getContractByAddress(\n        snapshotProposal.actionId,\n        contracts\n      );\n\n      const processArguments: ProcessArguments = [\n        daoRegistryAddress,\n        snapshotProposal.idInDAO,\n      ];\n\n      const txArguments = {\n        from: account || '',\n        // Set a fast gas price\n        ...(gasPrices ? {gasPrice: gasPrices.fast} : null),\n      };\n\n      await txSend(\n        'processProposal',\n        contract.instance.methods,\n        processArguments,\n        txArguments\n      );\n    } catch (error) {\n      setSubmitError(error);\n    }\n  }\n\n  /**\n   * Render\n   */\n\n  function renderSubmitStatus(): React.ReactNode {\n    // Only for chain tx\n    switch (txStatus) {\n      case Web3TxStatus.AWAITING_CONFIRM:\n        return (\n          <>\n            Awaiting your confirmation\n            <CycleEllipsis />\n          </>\n        );\n      case Web3TxStatus.PENDING:\n        return (\n          <>\n            <CycleMessage\n              intervalMs={2000}\n              messages={TX_CYCLE_MESSAGES}\n              useFirstItemStart\n              render={(message) => {\n                return <FadeIn key={message}>{message}</FadeIn>;\n              }}\n            />\n\n            <EtherscanURL url={txEtherscanURL} isPending />\n          </>\n        );\n      case Web3TxStatus.FULFILLED:\n        return (\n          <>\n            <div>Proposal submitted!</div>\n\n            <EtherscanURL url={txEtherscanURL} />\n          </>\n        );\n      default:\n        return null;\n    }\n  }\n\n  return (\n    <>\n      <div>\n        <button\n          className=\"proposaldetails__button\"\n          disabled={areSomeDisabled}\n          onClick={areSomeDisabled ? () => {} : handleSubmit}>\n          {isInProcess ? <Loader /> : isDone ? 'Done' : 'Process'}\n        </button>\n\n        <ErrorMessageWithDetails\n          error={submitError}\n          renderText=\"Something went wrong\"\n        />\n\n        {/* SUBMIT STATUS */}\n\n        {isInProcessOrDone && (\n          <div className=\"form__submit-status-container\">\n            {renderSubmitStatus()}\n          </div>\n        )}\n\n        {isDisabled && (\n          <button\n            className=\"button--help-centered\"\n            onClick={openWhyDisabledModal}>\n            Why is processing disabled?\n          </button>\n        )}\n      </div>\n\n      <WhyDisabledModal title=\"Why is processing disabled?\" />\n    </>\n  );\n}\n","import {useState, useRef, useEffect, useCallback} from 'react';\nimport {useSelector} from 'react-redux';\n\nimport {CycleEllipsis} from '../feedback';\nimport {ProposalData, SnapshotProposal} from './types';\nimport {StoreState} from '../../store/types';\nimport {TX_CYCLE_MESSAGES} from '../web3/config';\nimport {useContractSend, useETHGasPrice, useWeb3Modal} from '../web3/hooks';\nimport {useMemberActionDisabled} from '../../hooks';\nimport {Web3TxStatus} from '../web3/types';\nimport CycleMessage from '../feedback/CycleMessage';\nimport ErrorMessageWithDetails from '../common/ErrorMessageWithDetails';\nimport EtherscanURL from '../web3/EtherscanURL';\nimport FadeIn from '../common/FadeIn';\nimport Loader from '../feedback/Loader';\n\ntype ProcessArguments = [\n  string, // `dao`\n  string // `proposalId`\n];\n\ntype ProcessActionMembershipProps = {\n  disabled?: boolean;\n  proposal: ProposalData;\n  isProposalPassed: boolean;\n};\n\ntype ActionDisabledReasons = {\n  notProposerMessage: string;\n};\n\n/**\n * Cached outside the component to prevent infinite re-renders.\n *\n * The same can be accomplished inside the component using\n * `useState`, `useRef`, etc., depending on the use case.\n */\nconst useMemberActionDisabledProps = {\n  // Anyone can process a proposal - it's just a question of gas payment.\n  skipIsActiveMemberCheck: true,\n};\n\nexport default function ProcessActionMembership(\n  props: ProcessActionMembershipProps\n) {\n  const {\n    disabled: propsDisabled,\n    proposal: {snapshotProposal},\n    isProposalPassed,\n  } = props;\n\n  /**\n   * State\n   */\n\n  const [submitError, setSubmitError] = useState<Error>();\n  const [\n    membershipProposalAmount,\n    setMembershipProposalAmount,\n  ] = useState<string>();\n\n  /**\n   * Refs\n   */\n\n  const actionDisabledReasonsRef = useRef<ActionDisabledReasons>({\n    notProposerMessage: '',\n  });\n\n  /**\n   * Selectors\n   */\n\n  const OnboardingContract = useSelector(\n    (state: StoreState) => state.contracts?.OnboardingContract\n  );\n  const daoRegistryAddress = useSelector(\n    (s: StoreState) => s.contracts.DaoRegistryContract?.contractAddress\n  );\n\n  /**\n   * Our hooks\n   */\n\n  const {account} = useWeb3Modal();\n  const {txEtherscanURL, txIsPromptOpen, txSend, txStatus} = useContractSend();\n  const {\n    isDisabled,\n    openWhyDisabledModal,\n    WhyDisabledModal,\n    setOtherDisabledReasons,\n  } = useMemberActionDisabled(useMemberActionDisabledProps);\n  const gasPrices = useETHGasPrice();\n\n  /**\n   * Variables\n   */\n\n  const isInProcess =\n    txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    txStatus === Web3TxStatus.PENDING;\n  const isDone = txStatus === Web3TxStatus.FULFILLED;\n  const isInProcessOrDone = isInProcess || isDone || txIsPromptOpen;\n  const areSomeDisabled = isDisabled || isInProcessOrDone || propsDisabled;\n\n  /**\n   * Cached callbacks\n   */\n\n  const getMembershipProposalAmountCached = useCallback(\n    getMembershipProposalAmount,\n    [OnboardingContract, daoRegistryAddress, snapshotProposal]\n  );\n\n  /**\n   * Effects\n   */\n\n  useEffect(() => {\n    if (isProposalPassed) {\n      getMembershipProposalAmountCached();\n    }\n  }, [getMembershipProposalAmountCached, isProposalPassed]);\n\n  useEffect(() => {\n    if (isProposalPassed) {\n      // 1. Determine and set reasons why action would be disabled\n\n      // Reason: For some proposal types, a passed proposal can only be\n      // processed by its original proposer (e.g., the owner of the asset to be\n      // transferred)\n\n      // Proposals with this restriction will have this value stored in its\n      // snapshot metadata.\n      const {\n        accountAuthorizedToProcessPassedProposal,\n      } = (snapshotProposal as SnapshotProposal).msg.payload.metadata;\n\n      if (accountAuthorizedToProcessPassedProposal && account) {\n        actionDisabledReasonsRef.current = {\n          ...actionDisabledReasonsRef.current,\n          notProposerMessage:\n            accountAuthorizedToProcessPassedProposal.toLowerCase() !==\n            account.toLowerCase()\n              ? 'Only the original proposer can process the proposal.'\n              : '',\n        };\n      }\n\n      // 2. Set reasons\n      setOtherDisabledReasons(Object.values(actionDisabledReasonsRef.current));\n    }\n  }, [account, isProposalPassed, setOtherDisabledReasons, snapshotProposal]);\n\n  /**\n   * Functions\n   */\n\n  async function getMembershipProposalAmount() {\n    try {\n      if (!snapshotProposal || !OnboardingContract) return;\n\n      const proposalDetails = await OnboardingContract.instance.methods\n        .proposals(daoRegistryAddress, snapshotProposal.idInDAO)\n        .call();\n\n      setMembershipProposalAmount(proposalDetails.amount);\n    } catch (error) {\n      console.error(error);\n      setMembershipProposalAmount(undefined);\n    }\n  }\n\n  async function handleSubmit() {\n    try {\n      if (!daoRegistryAddress) {\n        throw new Error('No DAO Registry address was found.');\n      }\n\n      if (!snapshotProposal) {\n        throw new Error('No Snapshot proposal was found.');\n      }\n\n      if (!OnboardingContract) {\n        throw new Error('No OnboardingContract found.');\n      }\n\n      const processArguments: ProcessArguments = [\n        daoRegistryAddress,\n        snapshotProposal.idInDAO,\n      ];\n\n      const txArguments = {\n        from: account || '',\n        value: membershipProposalAmount,\n        // Set a fast gas price\n        ...(gasPrices ? {gasPrice: gasPrices.fast} : null),\n      };\n\n      await txSend(\n        'processProposal',\n        OnboardingContract.instance.methods,\n        processArguments,\n        txArguments\n      );\n    } catch (error) {\n      setSubmitError(error);\n    }\n  }\n\n  /**\n   * Render\n   */\n\n  function renderSubmitStatus(): React.ReactNode {\n    // process proposal transaction statuses\n    switch (txStatus) {\n      case Web3TxStatus.AWAITING_CONFIRM:\n        return (\n          <>\n            Confirm to process the proposal\n            <CycleEllipsis />\n          </>\n        );\n      case Web3TxStatus.PENDING:\n        return (\n          <>\n            <CycleMessage\n              intervalMs={2000}\n              messages={TX_CYCLE_MESSAGES}\n              useFirstItemStart\n              render={(message) => {\n                return <FadeIn key={message}>{message}</FadeIn>;\n              }}\n            />\n\n            <EtherscanURL url={txEtherscanURL} isPending />\n          </>\n        );\n      case Web3TxStatus.FULFILLED:\n        return (\n          <>\n            <div>Proposal submitted!</div>\n\n            <EtherscanURL url={txEtherscanURL} />\n          </>\n        );\n      default:\n        return null;\n    }\n  }\n\n  return (\n    <>\n      {isProposalPassed ? (\n        <>\n          <div>\n            <button\n              className=\"proposaldetails__button\"\n              disabled={areSomeDisabled}\n              onClick={areSomeDisabled ? () => {} : handleSubmit}>\n              {isInProcess ? <Loader /> : isDone ? 'Done' : 'Process'}\n            </button>\n\n            <ErrorMessageWithDetails\n              error={submitError}\n              renderText=\"Something went wrong\"\n            />\n\n            {/* SUBMIT STATUS */}\n\n            {isInProcessOrDone && (\n              <div className=\"form__submit-status-container\">\n                {renderSubmitStatus()}\n              </div>\n            )}\n\n            {isDisabled && (\n              <button\n                className=\"button--help-centered\"\n                onClick={openWhyDisabledModal}>\n                Why is processing disabled?\n              </button>\n            )}\n          </div>\n\n          <WhyDisabledModal title=\"Why is processing disabled?\" />\n        </>\n      ) : (\n        // If proposal failed there is no reason to process it. So just show\n        // nothing.\n        <></>\n      )}\n    </>\n  );\n}\n","import {useState, useRef, useEffect, useCallback} from 'react';\nimport {useSelector} from 'react-redux';\nimport {toBN, AbiItem} from 'web3-utils';\n\nimport {CycleEllipsis} from '../feedback';\nimport {ProposalData, SnapshotProposal} from './types';\nimport {StoreState} from '../../store/types';\nimport {TX_CYCLE_MESSAGES} from '../web3/config';\nimport {useContractSend, useETHGasPrice, useWeb3Modal} from '../web3/hooks';\nimport {useMemberActionDisabled} from '../../hooks';\nimport {Web3TxStatus} from '../web3/types';\nimport CycleMessage from '../feedback/CycleMessage';\nimport ErrorMessageWithDetails from '../common/ErrorMessageWithDetails';\nimport EtherscanURL from '../web3/EtherscanURL';\nimport FadeIn from '../common/FadeIn';\nimport Loader from '../feedback/Loader';\n\ntype ProcessArguments = [\n  string, // `dao`\n  string // `proposalId`\n];\n\ntype TokenApproveArguments = [\n  string, // `spender`\n  string // `value`\n];\n\ntype TributeProposalDetails = {\n  tokenAddress: string;\n  tributeAmount: string;\n};\n\ntype ProcessActionTributeProps = {\n  disabled?: boolean;\n  proposal: ProposalData;\n  isProposalPassed: boolean;\n};\n\ntype ActionDisabledReasons = {\n  notProposerMessage: string;\n};\n\n/**\n * Cached outside the component to prevent infinite re-renders.\n *\n * The same can be accomplished inside the component using\n * `useState`, `useRef`, etc., depending on the use case.\n */\nconst useMemberActionDisabledProps = {\n  // Anyone can process a proposal - it's just a question of gas payment.\n  skipIsActiveMemberCheck: true,\n};\n\nexport default function ProcessActionTribute(props: ProcessActionTributeProps) {\n  const {\n    disabled: propsDisabled,\n    proposal: {snapshotProposal},\n    isProposalPassed,\n  } = props;\n\n  /**\n   * State\n   */\n\n  const [submitError, setSubmitError] = useState<Error>();\n  const [\n    tributeProposalDetails,\n    setTributeProposalDetails,\n  ] = useState<TributeProposalDetails>();\n\n  /**\n   * Refs\n   */\n\n  const actionDisabledReasonsRef = useRef<ActionDisabledReasons>({\n    notProposerMessage: '',\n  });\n\n  /**\n   * Selectors\n   */\n\n  const TributeContract = useSelector(\n    (state: StoreState) => state.contracts?.TributeContract\n  );\n  const daoRegistryAddress = useSelector(\n    (s: StoreState) => s.contracts.DaoRegistryContract?.contractAddress\n  );\n\n  /**\n   * Our hooks\n   */\n\n  const {account, web3Instance} = useWeb3Modal();\n  const {txEtherscanURL, txIsPromptOpen, txSend, txStatus} = useContractSend();\n  const {\n    txEtherscanURL: txEtherscanURLTokenApprove,\n    txIsPromptOpen: txIsPromptOpenTokenApprove,\n    txSend: txSendTokenApprove,\n    txStatus: txStatusTokenApprove,\n  } = useContractSend();\n  const {\n    isDisabled,\n    openWhyDisabledModal,\n    WhyDisabledModal,\n    setOtherDisabledReasons,\n  } = useMemberActionDisabled(useMemberActionDisabledProps);\n  const gasPrices = useETHGasPrice();\n\n  /**\n   * Variables\n   */\n\n  const isInProcess =\n    txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    txStatus === Web3TxStatus.PENDING ||\n    txStatusTokenApprove === Web3TxStatus.AWAITING_CONFIRM ||\n    txStatusTokenApprove === Web3TxStatus.PENDING;\n  const isDone = txStatus === Web3TxStatus.FULFILLED;\n  const isInProcessOrDone =\n    isInProcess || isDone || txIsPromptOpen || txIsPromptOpenTokenApprove;\n  const areSomeDisabled = isDisabled || isInProcessOrDone || propsDisabled;\n\n  /**\n   * Cached callbacks\n   */\n\n  const getTributeProposalDetailsCached = useCallback(\n    getTributeProposalDetails,\n    [TributeContract, daoRegistryAddress, snapshotProposal]\n  );\n\n  /**\n   * Effects\n   */\n\n  useEffect(() => {\n    if (isProposalPassed) {\n      getTributeProposalDetailsCached();\n    }\n  }, [getTributeProposalDetailsCached, isProposalPassed]);\n\n  useEffect(() => {\n    if (isProposalPassed) {\n      // 1. Determine and set reasons why action would be disabled\n\n      // Reason: For some proposal types, a passed proposal can only be\n      // processed by its original proposer (e.g., the owner of the asset to be\n      // transferred)\n\n      // Proposals with this restriction will have this value stored in its\n      // snapshot metadata.\n      const {\n        accountAuthorizedToProcessPassedProposal,\n      } = (snapshotProposal as SnapshotProposal).msg.payload.metadata;\n\n      if (accountAuthorizedToProcessPassedProposal && account) {\n        actionDisabledReasonsRef.current = {\n          ...actionDisabledReasonsRef.current,\n          notProposerMessage:\n            accountAuthorizedToProcessPassedProposal.toLowerCase() !==\n            account.toLowerCase()\n              ? 'Only the original proposer can process the proposal.'\n              : '',\n        };\n      }\n\n      // 2. Set reasons\n      setOtherDisabledReasons(Object.values(actionDisabledReasonsRef.current));\n    }\n  }, [account, isProposalPassed, setOtherDisabledReasons, snapshotProposal]);\n\n  /**\n   * Functions\n   */\n\n  async function getTributeProposalDetails() {\n    try {\n      if (!snapshotProposal || !TributeContract) return;\n\n      const proposalDetails = await TributeContract.instance.methods\n        .proposals(daoRegistryAddress, snapshotProposal.idInDAO)\n        .call();\n      const {token: tokenAddress, tributeAmount} = proposalDetails;\n\n      setTributeProposalDetails({tokenAddress, tributeAmount});\n    } catch (error) {\n      console.error(error);\n      setTributeProposalDetails(undefined);\n    }\n  }\n\n  async function handleSubmitTokenApprove() {\n    try {\n      if (!tributeProposalDetails) {\n        throw new Error('No Tribute proposal details found.');\n      }\n\n      if (!TributeContract) {\n        throw new Error('No TributeContract found.');\n      }\n\n      if (!account) {\n        throw new Error('No account found.');\n      }\n\n      const {tokenAddress, tributeAmount} = tributeProposalDetails;\n\n      const {default: lazyERC20ABI} = await import(\n        '../../truffle-contracts/ERC20.json'\n      );\n      const erc20Contract: AbiItem[] = lazyERC20ABI as any;\n      const erc20Instance = new web3Instance.eth.Contract(\n        erc20Contract,\n        tokenAddress\n      );\n\n      // Value to check if adapter is allowed to spend amount of tribute tokens\n      // on behalf of owner. If allowance is not sufficient, the owner will approve the adapter to spend the amount of\n      // tokens needed for the owner to provide the full tribute amount.\n      const allowance = await erc20Instance.methods\n        .allowance(account, TributeContract.contractAddress)\n        .call();\n\n      const tributeAmountBN = toBN(tributeAmount);\n      const allowanceBN = toBN(allowance);\n\n      if (tributeAmountBN.gt(allowanceBN)) {\n        try {\n          const difference = tributeAmountBN.sub(allowanceBN);\n          const approveValue = allowanceBN.add(difference);\n          const tokenApproveArguments: TokenApproveArguments = [\n            TributeContract.contractAddress,\n            approveValue.toString(),\n          ];\n          const txArguments = {\n            from: account || '',\n            // Set a fast gas price\n            ...(gasPrices ? {gasPrice: gasPrices.fast} : null),\n          };\n\n          // Execute contract call for `approve`\n          await txSendTokenApprove(\n            'approve',\n            erc20Instance.methods,\n            tokenApproveArguments,\n            txArguments\n          );\n        } catch (error) {\n          throw new Error(\n            'Your ERC20 tokens could not be approved for transfer.'\n          );\n        }\n      }\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  async function handleSubmit() {\n    try {\n      if (!daoRegistryAddress) {\n        throw new Error('No DAO Registry address was found.');\n      }\n\n      if (!snapshotProposal) {\n        throw new Error('No Snapshot proposal was found.');\n      }\n\n      if (!TributeContract) {\n        throw new Error('No TributeContract found.');\n      }\n\n      await handleSubmitTokenApprove();\n\n      const processArguments: ProcessArguments = [\n        daoRegistryAddress,\n        snapshotProposal.idInDAO,\n      ];\n\n      const txArguments = {\n        from: account || '',\n        // Set a fast gas price\n        ...(gasPrices ? {gasPrice: gasPrices.fast} : null),\n      };\n\n      await txSend(\n        'processProposal',\n        TributeContract.instance.methods,\n        processArguments,\n        txArguments\n      );\n    } catch (error) {\n      setSubmitError(error);\n    }\n  }\n\n  /**\n   * Render\n   */\n\n  function renderSubmitStatus(): React.ReactNode {\n    // token approve transaction statuses\n    if (txStatusTokenApprove === Web3TxStatus.AWAITING_CONFIRM) {\n      return (\n        <>\n          Confirm to transfer your tokens\n          <CycleEllipsis />\n        </>\n      );\n    }\n\n    if (txStatusTokenApprove === Web3TxStatus.PENDING) {\n      return (\n        <>\n          <div>\n            Approving your tokens for transfer\n            <CycleEllipsis />\n          </div>\n          <EtherscanURL url={txEtherscanURLTokenApprove} isPending />\n        </>\n      );\n    }\n\n    // process proposal transaction statuses\n    switch (txStatus) {\n      case Web3TxStatus.AWAITING_CONFIRM:\n        return (\n          <>\n            Confirm to process the proposal\n            <CycleEllipsis />\n          </>\n        );\n      case Web3TxStatus.PENDING:\n        return (\n          <>\n            <CycleMessage\n              intervalMs={2000}\n              messages={TX_CYCLE_MESSAGES}\n              useFirstItemStart\n              render={(message) => {\n                return <FadeIn key={message}>{message}</FadeIn>;\n              }}\n            />\n\n            <EtherscanURL url={txEtherscanURL} isPending />\n          </>\n        );\n      case Web3TxStatus.FULFILLED:\n        return (\n          <>\n            <div>Proposal submitted!</div>\n\n            <EtherscanURL url={txEtherscanURL} />\n          </>\n        );\n      default:\n        return null;\n    }\n  }\n\n  return (\n    <>\n      {isProposalPassed ? (\n        <>\n          <div>\n            <button\n              className=\"proposaldetails__button\"\n              disabled={areSomeDisabled}\n              onClick={areSomeDisabled ? () => {} : handleSubmit}>\n              {isInProcess ? <Loader /> : isDone ? 'Done' : 'Process'}\n            </button>\n\n            <ErrorMessageWithDetails\n              error={submitError}\n              renderText=\"Something went wrong\"\n            />\n\n            {/* SUBMIT STATUS */}\n\n            {isInProcessOrDone && (\n              <div className=\"form__submit-status-container\">\n                {renderSubmitStatus()}\n              </div>\n            )}\n\n            {isDisabled && (\n              <button\n                className=\"button--help-centered\"\n                onClick={openWhyDisabledModal}>\n                Why is processing disabled?\n              </button>\n            )}\n          </div>\n\n          <WhyDisabledModal title=\"Why is processing disabled?\" />\n        </>\n      ) : (\n        // If proposal failed there is no reason to process it. So just show\n        // nothing.\n        <></>\n      )}\n    </>\n  );\n}\n","import React, {useEffect, useState, useRef} from 'react';\nimport {useSelector} from 'react-redux';\n\nimport {CycleEllipsis} from '../feedback';\nimport {getContractByAddress} from '../web3/helpers';\nimport {ProposalData, DistributionStatus} from './types';\nimport {StoreState} from '../../store/types';\nimport {TX_CYCLE_MESSAGES} from '../web3/config';\nimport {useContractSend, useETHGasPrice, useWeb3Modal} from '../web3/hooks';\nimport {useMemberActionDisabled} from '../../hooks';\nimport {ContractAdapterNames, Web3TxStatus} from '../web3/types';\nimport CycleMessage from '../feedback/CycleMessage';\nimport ErrorMessageWithDetails from '../common/ErrorMessageWithDetails';\nimport EtherscanURL from '../web3/EtherscanURL';\nimport FadeIn from '../common/FadeIn';\nimport Loader from '../feedback/Loader';\n\ntype ProcessActionProps = {\n  adapterName: ContractAdapterNames;\n  proposal: ProposalData;\n};\n\ntype SubmitConfigs = {\n  functionName: string;\n  functionArguments: any[];\n};\n\ntype ActionDisabledReasons = {\n  alreadyCompletedMessage: string;\n};\n\n/**\n * @note Attempt to keep this component general to handle any adapters that may\n * have post-process actions\n */\nexport default function PostProcessAction(props: ProcessActionProps) {\n  const {\n    adapterName,\n    proposal: {snapshotProposal},\n  } = props;\n\n  /**\n   * State\n   */\n\n  const [submitError, setSubmitError] = useState<Error>();\n\n  /**\n   * Refs\n   */\n\n  const actionDisabledReasonsRef = useRef<ActionDisabledReasons>({\n    alreadyCompletedMessage: '',\n  });\n\n  /**\n   * Selectors\n   */\n\n  const contracts = useSelector((s: StoreState) => s.contracts);\n  const daoRegistryContract = useSelector(\n    (s: StoreState) => s.contracts.DaoRegistryContract\n  );\n\n  /**\n   * Our hooks\n   */\n\n  const {account} = useWeb3Modal();\n\n  const {txEtherscanURL, txIsPromptOpen, txSend, txStatus} = useContractSend();\n\n  const {\n    isDisabled,\n    openWhyDisabledModal,\n    WhyDisabledModal,\n    setOtherDisabledReasons,\n  } = useMemberActionDisabled();\n\n  const gasPrices = useETHGasPrice();\n\n  /**\n   * Variables\n   */\n\n  const isInProcess =\n    txStatus === Web3TxStatus.AWAITING_CONFIRM ||\n    txStatus === Web3TxStatus.PENDING;\n\n  const isDone = txStatus === Web3TxStatus.FULFILLED;\n  const isInProcessOrDone = isInProcess || isDone || txIsPromptOpen;\n  const areSomeDisabled = isDisabled || isInProcessOrDone;\n\n  /**\n   * Effects\n   */\n\n  useEffect(() => {\n    async function getActionDisabledReasons() {\n      // 1. Determine and set reasons why action would be disabled\n\n      // Reason: distribution already completed\n      if (adapterName === ContractAdapterNames.distribute) {\n        if (!snapshotProposal) {\n          throw new Error('No Snapshot proposal was found.');\n        }\n        if (!daoRegistryContract) {\n          throw new Error('No DAO Registry contract was found.');\n        }\n\n        try {\n          const distributeContract = getContractByAddress(\n            snapshotProposal.actionId,\n            contracts\n          );\n          const distributeProposal = await distributeContract.instance.methods\n            .distributions(\n              daoRegistryContract.contractAddress,\n              snapshotProposal.idInDAO\n            )\n            .call();\n\n          actionDisabledReasonsRef.current = {\n            ...actionDisabledReasonsRef.current,\n            alreadyCompletedMessage:\n              DistributionStatus[distributeProposal.status] !==\n              DistributionStatus[DistributionStatus.IN_PROGRESS]\n                ? 'The transfer has already been completed.'\n                : '',\n          };\n        } catch (error) {\n          console.error(error);\n        }\n      }\n\n      // 2. Set reasons\n      setOtherDisabledReasons(Object.values(actionDisabledReasonsRef.current));\n    }\n\n    getActionDisabledReasons();\n  }, [\n    adapterName,\n    contracts,\n    daoRegistryContract,\n    setOtherDisabledReasons,\n    snapshotProposal,\n  ]);\n\n  /**\n   * Functions\n   */\n\n  async function getSubmitConfigsByAdapter(): Promise<SubmitConfigs> {\n    switch (adapterName) {\n      case ContractAdapterNames.distribute:\n        if (!daoRegistryContract) {\n          throw new Error('No DAO Registry contract was found.');\n        }\n\n        let toIndexArg = '0';\n        const isTypeAllMembers =\n          snapshotProposal?.msg.payload.metadata.isTypeAllMembers;\n        if (isTypeAllMembers) {\n          try {\n            const nbMembers = await daoRegistryContract.instance.methods\n              .getNbMembers()\n              .call();\n            toIndexArg = nbMembers.toString();\n          } catch (error) {\n            throw new Error('Error while retrieving number of DAO members');\n          }\n        }\n\n        return {\n          functionName: 'distribute',\n          functionArguments: [daoRegistryContract.contractAddress, toIndexArg],\n        };\n      default:\n        return {functionName: '', functionArguments: []};\n    }\n  }\n\n  async function handleSubmit() {\n    try {\n      if (!snapshotProposal) {\n        throw new Error('No Snapshot proposal was found.');\n      }\n\n      const contract = getContractByAddress(\n        snapshotProposal.actionId,\n        contracts\n      );\n\n      const {\n        functionName,\n        functionArguments,\n      } = await getSubmitConfigsByAdapter();\n\n      const txArguments = {\n        from: account || '',\n        // Set a fast gas price\n        ...(gasPrices ? {gasPrice: gasPrices.fast} : null),\n      };\n\n      await txSend(\n        functionName,\n        contract.instance.methods,\n        functionArguments,\n        txArguments\n      );\n    } catch (error) {\n      setSubmitError(error);\n    }\n  }\n\n  /**\n   * Render\n   */\n\n  function renderSubmitStatusByAdapter(): string {\n    switch (adapterName) {\n      case ContractAdapterNames.distribute:\n        return 'Assets transferred!';\n      default:\n        return 'Action submitted!';\n    }\n  }\n\n  function renderButtonTextByAdapter(): {start: string; done: string} {\n    switch (adapterName) {\n      case ContractAdapterNames.distribute:\n        return {start: 'Transfer assets', done: 'Transfer done'};\n      default:\n        return {start: 'Process action', done: 'Done'};\n    }\n  }\n\n  function renderSubmitStatus(): React.ReactNode {\n    // Only for chain tx\n    switch (txStatus) {\n      case Web3TxStatus.AWAITING_CONFIRM:\n        return (\n          <>\n            Awaiting your confirmation\n            <CycleEllipsis />\n          </>\n        );\n      case Web3TxStatus.PENDING:\n        return (\n          <>\n            <CycleMessage\n              intervalMs={2000}\n              messages={TX_CYCLE_MESSAGES}\n              useFirstItemStart\n              render={(message) => {\n                return <FadeIn key={message}>{message}</FadeIn>;\n              }}\n            />\n\n            <EtherscanURL url={txEtherscanURL} isPending />\n          </>\n        );\n      case Web3TxStatus.FULFILLED:\n        return (\n          <>\n            <div>{renderSubmitStatusByAdapter()}</div>\n\n            <EtherscanURL url={txEtherscanURL} />\n          </>\n        );\n      default:\n        return null;\n    }\n  }\n\n  return (\n    <>\n      <div>\n        <button\n          className=\"proposaldetails__button\"\n          disabled={areSomeDisabled}\n          onClick={areSomeDisabled ? () => {} : handleSubmit}>\n          {isInProcess ? (\n            <Loader />\n          ) : isDone ? (\n            renderButtonTextByAdapter()['done']\n          ) : (\n            renderButtonTextByAdapter()['start']\n          )}\n        </button>\n\n        <ErrorMessageWithDetails\n          error={submitError}\n          renderText=\"Something went wrong\"\n        />\n\n        {/* SUBMIT STATUS */}\n\n        {isInProcessOrDone && (\n          <div className=\"form__submit-status-container\">\n            {renderSubmitStatus()}\n          </div>\n        )}\n\n        {isDisabled && (\n          <button\n            className=\"button--help-centered\"\n            onClick={openWhyDisabledModal}>\n            Why is action disabled?\n          </button>\n        )}\n      </div>\n\n      <WhyDisabledModal title=\"Why is action disabled?\" />\n    </>\n  );\n}\n","import {\n  OffchainVotingStatus,\n  OffchainVotingAction,\n  OffchainOpRollupVotingSubmitResultAction,\n} from './voting';\nimport {VotingState} from './voting/types';\nimport {ContractAdapterNames} from '../web3/types';\nimport {ProposalData, ProposalFlowStatus} from './types';\nimport {useProposalWithOffchainVoteStatus} from './hooks';\nimport SubmitAction from './SubmitAction';\nimport SponsorAction from './SponsorAction';\nimport ProcessAction from './ProcessAction';\nimport ProcessActionMembership from './ProcessActionMembership';\nimport ProcessActionTribute from './ProcessActionTribute';\nimport PostProcessAction from './PostProcessAction';\n\ntype ProposalWithOffchainActionsProps = {\n  adapterName: ContractAdapterNames;\n  proposal: ProposalData;\n};\n\nexport default function ProposalWithOffchainVoteActions(\n  props: ProposalWithOffchainActionsProps\n) {\n  const {adapterName, proposal} = props;\n\n  /**\n   * Our hooks\n   */\n\n  const {\n    daoProposalVotes,\n    status,\n    daoProposalVoteResult,\n  } = useProposalWithOffchainVoteStatus(proposal);\n\n  /**\n   * Variables\n   */\n\n  // Set the grace period start (per the DAO's timestamp) if the status says we're in grace period.\n  const gracePeriodStartMs: number =\n    daoProposalVotes && status === ProposalFlowStatus.OffchainVotingGracePeriod\n      ? Number(daoProposalVotes.gracePeriodStartingTime) * 1000\n      : 0;\n\n  //  Currently, only Distribute adapter has an action that occurs after the\n  //  proposal is processed.\n  const showPostProcessAction =\n    adapterName === ContractAdapterNames.distribute &&\n    status === ProposalFlowStatus.Completed &&\n    daoProposalVoteResult &&\n    VotingState[daoProposalVoteResult] === VotingState[VotingState.PASS];\n\n  /**\n   * Functions\n   */\n\n  function renderProcessAction() {\n    switch (adapterName) {\n      case ContractAdapterNames.onboarding:\n        return (\n          <ProcessActionMembership\n            // Show during DAO proposal grace period, but set to disabled\n            disabled={status === ProposalFlowStatus.OffchainVotingGracePeriod}\n            proposal={proposal}\n            isProposalPassed={\n              !!(\n                daoProposalVoteResult &&\n                VotingState[daoProposalVoteResult] ===\n                  VotingState[VotingState.PASS]\n              )\n            }\n          />\n        );\n      case ContractAdapterNames.tribute:\n        return (\n          <ProcessActionTribute\n            // Show during DAO proposal grace period, but set to disabled\n            disabled={status === ProposalFlowStatus.OffchainVotingGracePeriod}\n            proposal={proposal}\n            isProposalPassed={\n              !!(\n                daoProposalVoteResult &&\n                VotingState[daoProposalVoteResult] ===\n                  VotingState[VotingState.PASS]\n              )\n            }\n          />\n        );\n      default:\n        return (\n          <ProcessAction\n            // Show during DAO proposal grace period, but set to disabled\n            disabled={status === ProposalFlowStatus.OffchainVotingGracePeriod}\n            proposal={proposal}\n          />\n        );\n    }\n  }\n\n  /**\n   * Render\n   */\n  return (\n    <>\n      {/* OFF-CHAIN VOTING STATUS */}\n      {(status === ProposalFlowStatus.OffchainVoting ||\n        status === ProposalFlowStatus.OffchainVotingSubmitResult ||\n        status === ProposalFlowStatus.OffchainVotingGracePeriod ||\n        status === ProposalFlowStatus.Process ||\n        status === ProposalFlowStatus.Completed) && (\n        <OffchainVotingStatus\n          countdownGracePeriodStartMs={gracePeriodStartMs}\n          proposal={proposal}\n        />\n      )}\n\n      <div className=\"proposaldetails__button-container\">\n        {/* SUBMIT/SPONSOR BUTTON (for proposals that have not been submitted onchain yet) */}\n        {status === ProposalFlowStatus.Submit && (\n          <SubmitAction proposal={proposal} />\n        )}\n\n        {/* SPONSOR BUTTON */}\n        {status === ProposalFlowStatus.Sponsor && (\n          <SponsorAction proposal={proposal} />\n        )}\n\n        {/* OFF-CHAIN VOTING BUTTONS */}\n        {status === ProposalFlowStatus.OffchainVoting && (\n          <OffchainVotingAction adapterName={adapterName} proposal={proposal} />\n        )}\n\n        {/* OFF-CHAIN VOTING SUBMIT VOTE RESULT */}\n        {/* @todo Perhaps use a wrapping component to get the correct off-chain voting component (e.g. op-rollup, batch) */}\n        {status === ProposalFlowStatus.OffchainVotingSubmitResult && (\n          <OffchainOpRollupVotingSubmitResultAction\n            adapterName={adapterName}\n            proposal={proposal}\n          />\n        )}\n\n        {/* PROCESS BUTTON */}\n        {(status === ProposalFlowStatus.OffchainVotingGracePeriod ||\n          status === ProposalFlowStatus.Process) &&\n          renderProcessAction()}\n\n        {/* POST PROCESS BUTTON */}\n        {showPostProcessAction && (\n          <PostProcessAction adapterName={adapterName} proposal={proposal} />\n        )}\n      </div>\n    </>\n  );\n}\n"],"sourceRoot":""}