(this["webpackJsonpmolochv3-ui"]=this["webpackJsonpmolochv3-ui"]||[]).push([[6],{1003:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return T}));var a=r(0),n=r(6),s=r(144),c=r(61),o=r(10),i=r(49),u=r(17),d=r(77),l=r(35),b=r(4),p=r.n(b),j=r(3),O=r(13),h=r(5),f=r(1),x=r(18),m=r(70),g=r(33),v=r(94),w=r(20),N=r(66),I=r(146),y=r(110),P=r(23),A=r(60);function D(e){var t=e.adapterName,r=e.proposal.snapshotProposal,n=Object(f.useState)(),s=Object(h.a)(n,2),i=s[0],u=s[1],d=Object(f.useRef)({alreadyCompletedMessage:""}),b=Object(x.c)((function(e){return e.contracts})),D=Object(x.c)((function(e){return e.contracts.DaoRegistryContract})),F=Object(w.f)().account,k=Object(w.a)(),S=k.txEtherscanURL,E=k.txIsPromptOpen,C=k.txSend,L=k.txStatus,R=Object(N.e)(),M=R.isDisabled,_=R.openWhyDisabledModal,G=R.WhyDisabledModal,W=R.setOtherDisabledReasons,T=Object(w.b)(),U=L===o.e.AWAITING_CONFIRM||L===o.e.PENDING,V=L===o.e.FULFILLED,z=U||V||E,B=M||z;function J(){return Y.apply(this,arguments)}function Y(){return(Y=Object(O.a)(p.a.mark((function e(){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===o.a.distribute?3:19;break;case 3:if(D){e.next=5;break}throw new Error("No DAO Registry contract was found.");case 5:if(a="0",!(null===r||void 0===r?void 0:r.msg.payload.metadata.isTypeAllMembers)){e.next=18;break}return e.prev=8,e.next=11,D.instance.methods.getNbMembers().call();case 11:n=e.sent,a=n.toString(),e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(8),new Error("Error while retrieving number of DAO members");case 18:return e.abrupt("return",{functionName:"distribute",functionArguments:[D.contractAddress,a]});case 19:return e.abrupt("return",{functionName:"",functionArguments:[]});case 20:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function q(){return(q=Object(O.a)(p.a.mark((function e(){var t,a,n,s,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r){e.next=3;break}throw new Error("No Snapshot proposal was found.");case 3:return t=Object(g.e)(r.actionId,b),e.next=6,J();case 6:return a=e.sent,n=a.functionName,s=a.functionArguments,c=Object(j.a)({from:F||""},T?{gasPrice:T.fast}:null),e.next=12,C(n,t.instance.methods,s,c);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),u(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))).apply(this,arguments)}function H(){switch(t){case o.a.distribute:return"Assets transferred!";default:return"Action submitted!"}}function K(){switch(t){case o.a.distribute:return{start:"Transfer assets",done:"Transfer done"};default:return{start:"Process action",done:"Done"}}}return Object(f.useEffect)((function(){function e(){return(e=Object(O.a)(p.a.mark((function e(){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==o.a.distribute){e.next=16;break}if(r){e.next=3;break}throw new Error("No Snapshot proposal was found.");case 3:if(D){e.next=5;break}throw new Error("No DAO Registry contract was found.");case 5:return e.prev=5,a=Object(g.e)(r.actionId,b),e.next=9,a.instance.methods.distributions(D.contractAddress,r.idInDAO).call();case 9:n=e.sent,d.current=Object(j.a)(Object(j.a)({},d.current),{},{alreadyCompletedMessage:c.a[n.status]!==c.a[c.a.IN_PROGRESS]?"The transfer has already been completed.":""}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),console.error(e.t0);case 16:W(Object.values(d.current));case 17:case"end":return e.stop()}}),e,null,[[5,13]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t,b,D,W,r]),Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:B,onClick:B?function(){}:function(){return q.apply(this,arguments)},children:U?Object(a.jsx)(A.a,{}):V?K().done:K().start}),Object(a.jsx)(l.a,{error:i,renderText:"Something went wrong"}),z&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){switch(L){case o.e.AWAITING_CONFIRM:return Object(a.jsxs)(a.Fragment,{children:["Awaiting your confirmation",Object(a.jsx)(m.a,{})]});case o.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(I.a,{intervalMs:2e3,messages:v.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(P.a,{children:e},e)}}),Object(a.jsx)(y.a,{url:S,isPending:!0})]});case o.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:H()}),Object(a.jsx)(y.a,{url:S})]});default:return null}}()}),M&&Object(a.jsx)("button",{className:"button--help-centered",onClick:_,children:"Why is action disabled?"})]}),Object(a.jsx)(G,{title:"Why is action disabled?"})]})}var F={skipIsActiveMemberCheck:!0};function k(e){var t=e.disabled,r=e.proposal.snapshotProposal,n=Object(f.useState)(),s=Object(h.a)(n,2),c=s[0],i=s[1],u=Object(x.c)((function(e){return e.contracts})),d=Object(x.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),b=Object(w.f)().account,D=Object(w.a)(),k=D.txEtherscanURL,S=D.txIsPromptOpen,E=D.txSend,C=D.txStatus,L=Object(N.e)(F),R=L.isDisabled,M=L.openWhyDisabledModal,_=L.WhyDisabledModal,G=Object(w.b)(),W=C===o.e.AWAITING_CONFIRM||C===o.e.PENDING,T=C===o.e.FULFILLED,U=W||T||S,V=R||U||t;function z(){return(z=Object(O.a)(p.a.mark((function e(){var t,a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(r){e.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:return t=Object(g.e)(r.actionId,u),a=[d,r.idInDAO],n=Object(j.a)({from:b||""},G?{gasPrice:G.fast}:null),e.next=10,E("processProposal",t.instance.methods,a,n);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),i(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:V,onClick:V?function(){}:function(){return z.apply(this,arguments)},children:W?Object(a.jsx)(A.a,{}):T?"Done":"Process"}),Object(a.jsx)(l.a,{error:c,renderText:"Something went wrong"}),U&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){switch(C){case o.e.AWAITING_CONFIRM:return Object(a.jsxs)(a.Fragment,{children:["Awaiting your confirmation",Object(a.jsx)(m.a,{})]});case o.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(I.a,{intervalMs:2e3,messages:v.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(P.a,{children:e},e)}}),Object(a.jsx)(y.a,{url:k,isPending:!0})]});case o.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Proposal submitted!"}),Object(a.jsx)(y.a,{url:k})]});default:return null}}()}),R&&Object(a.jsx)("button",{className:"button--help-centered",onClick:M,children:"Why is processing disabled?"})]}),Object(a.jsx)(_,{title:"Why is processing disabled?"})]})}var S={skipIsActiveMemberCheck:!0};function E(e){var t=e.disabled,r=e.proposal.snapshotProposal,n=e.isProposalPassed,s=Object(f.useState)(),c=Object(h.a)(s,2),i=c[0],u=c[1],d=Object(f.useState)(),b=Object(h.a)(d,2),g=b[0],D=b[1],F=Object(f.useRef)({notProposerMessage:""}),k=Object(x.c)((function(e){var t;return null===(t=e.contracts)||void 0===t?void 0:t.OnboardingContract})),E=Object(x.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),C=Object(w.f)().account,L=Object(w.a)(),R=L.txEtherscanURL,M=L.txIsPromptOpen,_=L.txSend,G=L.txStatus,W=Object(N.e)(S),T=W.isDisabled,U=W.openWhyDisabledModal,V=W.WhyDisabledModal,z=W.setOtherDisabledReasons,B=Object(w.b)(),J=G===o.e.AWAITING_CONFIRM||G===o.e.PENDING,Y=G===o.e.FULFILLED,q=J||Y||M,H=T||q||t,K=Object(f.useCallback)((function(){return Q.apply(this,arguments)}),[k,E,r]);function Q(){return(Q=Object(O.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r&&k){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,k.instance.methods.proposals(E,r.idInDAO).call();case 5:t=e.sent,D(t.amount),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0),D(void 0);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function X(){return(X=Object(O.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(r){e.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:if(k){e.next=7;break}throw new Error("No OnboardingContract found.");case 7:return t=[E,r.idInDAO],a=Object(j.a)({from:C||"",value:g},B?{gasPrice:B.fast}:null),e.next=11,_("processProposal",k.instance.methods,t,a);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),u(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}return Object(f.useEffect)((function(){n&&K()}),[K,n]),Object(f.useEffect)((function(){if(n){var e=r.msg.payload.metadata.accountAuthorizedToProcessPassedProposal;e&&C&&(F.current=Object(j.a)(Object(j.a)({},F.current),{},{notProposerMessage:e.toLowerCase()!==C.toLowerCase()?"Only the original proposer can process the proposal.":""})),z(Object.values(F.current))}}),[C,n,z,r]),Object(a.jsx)(a.Fragment,{children:n?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:H,onClick:H?function(){}:function(){return X.apply(this,arguments)},children:J?Object(a.jsx)(A.a,{}):Y?"Done":"Process"}),Object(a.jsx)(l.a,{error:i,renderText:"Something went wrong"}),q&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){switch(G){case o.e.AWAITING_CONFIRM:return Object(a.jsxs)(a.Fragment,{children:["Confirm to process the proposal",Object(a.jsx)(m.a,{})]});case o.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(I.a,{intervalMs:2e3,messages:v.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(P.a,{children:e},e)}}),Object(a.jsx)(y.a,{url:R,isPending:!0})]});case o.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Proposal submitted!"}),Object(a.jsx)(y.a,{url:R})]});default:return null}}()}),T&&Object(a.jsx)("button",{className:"button--help-centered",onClick:U,children:"Why is processing disabled?"})]}),Object(a.jsx)(V,{title:"Why is processing disabled?"})]}):Object(a.jsx)(a.Fragment,{})})}var C=r(25),L={skipIsActiveMemberCheck:!0};function R(e){var t=e.disabled,n=e.proposal.snapshotProposal,s=e.isProposalPassed,c=Object(f.useState)(),i=Object(h.a)(c,2),u=i[0],d=i[1],b=Object(f.useState)(),g=Object(h.a)(b,2),D=g[0],F=g[1],k=Object(f.useRef)({notProposerMessage:""}),S=Object(x.c)((function(e){var t;return null===(t=e.contracts)||void 0===t?void 0:t.TributeContract})),E=Object(x.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),R=Object(w.f)(),M=R.account,_=R.web3Instance,G=Object(w.a)(),W=G.txEtherscanURL,T=G.txIsPromptOpen,U=G.txSend,V=G.txStatus,z=Object(w.a)(),B=z.txEtherscanURL,J=z.txIsPromptOpen,Y=z.txSend,q=z.txStatus,H=Object(N.e)(L),K=H.isDisabled,Q=H.openWhyDisabledModal,X=H.WhyDisabledModal,Z=H.setOtherDisabledReasons,$=Object(w.b)(),ee=V===o.e.AWAITING_CONFIRM||V===o.e.PENDING||q===o.e.AWAITING_CONFIRM||q===o.e.PENDING,te=V===o.e.FULFILLED,re=ee||te||T||J,ae=K||re||t,ne=Object(f.useCallback)((function(){return se.apply(this,arguments)}),[S,E,n]);function se(){return(se=Object(O.a)(p.a.mark((function e(){var t,r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n&&S){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,S.instance.methods.proposals(E,n.idInDAO).call();case 5:t=e.sent,r=t.token,a=t.tributeAmount,F({tokenAddress:r,tributeAmount:a}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),F(void 0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function ce(){return oe.apply(this,arguments)}function oe(){return(oe=Object(O.a)(p.a.mark((function e(){var t,a,n,s,c,o,i,u,d,l,b,O,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,D){e.next=3;break}throw new Error("No Tribute proposal details found.");case 3:if(S){e.next=5;break}throw new Error("No TributeContract found.");case 5:if(M){e.next=7;break}throw new Error("No account found.");case 7:return t=D.tokenAddress,a=D.tributeAmount,e.next=10,Promise.resolve().then(r.t.bind(null,462,3));case 10:return n=e.sent,s=n.default,c=s,o=new _.eth.Contract(c,t),e.next=16,o.methods.allowance(M,S.contractAddress).call();case 16:if(i=e.sent,u=Object(C.toBN)(a),d=Object(C.toBN)(i),!u.gt(d)){e.next=32;break}return e.prev=20,l=u.sub(d),b=d.add(l),O=[S.contractAddress,b.toString()],h=Object(j.a)({from:M||""},$?{gasPrice:$.fast}:null),e.next=27,Y("approve",o.methods,O,h);case 27:e.next=32;break;case 29:throw e.prev=29,e.t0=e.catch(20),new Error("Your ERC20 tokens could not be approved for transfer.");case 32:e.next=37;break;case 34:throw e.prev=34,e.t1=e.catch(0),e.t1;case 37:case"end":return e.stop()}}),e,null,[[0,34],[20,29]])})))).apply(this,arguments)}function ie(){return(ie=Object(O.a)(p.a.mark((function e(){var t,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(n){e.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:if(S){e.next=7;break}throw new Error("No TributeContract found.");case 7:return e.next=9,ce();case 9:return t=[E,n.idInDAO],r=Object(j.a)({from:M||""},$?{gasPrice:$.fast}:null),e.next=13,U("processProposal",S.instance.methods,t,r);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),d(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}return Object(f.useEffect)((function(){s&&ne()}),[ne,s]),Object(f.useEffect)((function(){if(s){var e=n.msg.payload.metadata.accountAuthorizedToProcessPassedProposal;e&&M&&(k.current=Object(j.a)(Object(j.a)({},k.current),{},{notProposerMessage:e.toLowerCase()!==M.toLowerCase()?"Only the original proposer can process the proposal.":""})),Z(Object.values(k.current))}}),[M,s,Z,n]),Object(a.jsx)(a.Fragment,{children:s?Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:ae,onClick:ae?function(){}:function(){return ie.apply(this,arguments)},children:ee?Object(a.jsx)(A.a,{}):te?"Done":"Process"}),Object(a.jsx)(l.a,{error:u,renderText:"Something went wrong"}),re&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){if(q===o.e.AWAITING_CONFIRM)return Object(a.jsxs)(a.Fragment,{children:["Confirm to transfer your tokens",Object(a.jsx)(m.a,{})]});if(q===o.e.PENDING)return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:["Approving your tokens for transfer",Object(a.jsx)(m.a,{})]}),Object(a.jsx)(y.a,{url:B,isPending:!0})]});switch(V){case o.e.AWAITING_CONFIRM:return Object(a.jsxs)(a.Fragment,{children:["Confirm to process the proposal",Object(a.jsx)(m.a,{})]});case o.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(I.a,{intervalMs:2e3,messages:v.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(P.a,{children:e},e)}}),Object(a.jsx)(y.a,{url:W,isPending:!0})]});case o.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Proposal submitted!"}),Object(a.jsx)(y.a,{url:W})]});default:return null}}()}),K&&Object(a.jsx)("button",{className:"button--help-centered",onClick:Q,children:"Why is processing disabled?"})]}),Object(a.jsx)(X,{title:"Why is processing disabled?"})]}):Object(a.jsx)(a.Fragment,{})})}var M=r(19);function _(e){var t=e.proposal,r=t.snapshotDraft,n=t.refetchProposalOrDraft,s=Object(f.useState)(),c=Object(h.a)(s,2),u=c[0],d=c[1],b=Object(x.c)((function(e){return e.contracts})),m=Object(x.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),D=Object(w.f)(),F=D.account,k=D.web3Instance,S=Object(w.a)(),E=S.txEtherscanURL,C=S.txIsPromptOpen,L=S.txSend,R=S.txStatus,_=Object(N.e)(),G=_.isDisabled,W=_.openWhyDisabledModal,T=_.WhyDisabledModal,U=Object(i.g)(),V=U.proposalSignAndSendStatus,z=U.signAndSendProposal,B=Object(w.b)(),J=R===o.e.AWAITING_CONFIRM||R===o.e.PENDING||V===o.e.AWAITING_CONFIRM||V===o.e.PENDING,Y=R===o.e.FULFILLED&&V===o.e.FULFILLED,q=J||Y||C;function H(){return(H=Object(O.a)(p.a.mark((function e(){var t,a,s,c,o,i,u,l,O,h,f,x,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,m){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(r){e.next=5;break}throw new Error("No Snapshot draft was found.");case 5:return t=Object(g.e)(r.actionId,b),a=r.msg,s=a.payload,c=s.name,o=s.body,i=s.metadata,u=a.timestamp,e.next=9,z({partialProposalData:{name:c,body:o,metadata:i,timestamp:u},adapterAddress:t.contractAddress,type:M.SnapshotType.proposal});case 9:return l=e.sent,O=l.data,h=l.signature,f=Object(M.prepareVoteProposalData)({payload:{name:O.payload.name,body:O.payload.body,choices:O.payload.choices,snapshot:O.payload.snapshot.toString(),start:O.payload.start,end:O.payload.end},sig:h,space:O.space,timestamp:parseInt(O.timestamp)},k),x=[m,r.idInDAO,f],v=Object(j.a)({from:F||""},B?{gasPrice:B.fast}:null),e.next=17,L("sponsorProposal",t.instance.methods,x,v);case 17:n(),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),d(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:G||q,onClick:G||q?function(){}:function(){return H.apply(this,arguments)},children:J?Object(a.jsx)(A.a,{}):Y?"Done":"Sponsor"}),Object(a.jsx)(l.a,{error:u,renderText:"Something went wrong"}),q&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){if(R===o.e.AWAITING_CONFIRM||V===o.e.AWAITING_CONFIRM)return"Awaiting your confirmation\u2026";switch(R){case o.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(I.a,{intervalMs:2e3,messages:v.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(P.a,{children:e},e)}}),Object(a.jsx)(y.a,{url:E,isPending:!0})]});case o.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Proposal submitted!"}),Object(a.jsx)(y.a,{url:E})]});default:return null}}()}),G&&Object(a.jsx)("button",{className:"button--help-centered",onClick:W,children:"Why is sponsoring disabled?"})]}),Object(a.jsx)(T,{title:"Why is sponsoring disabled?"})]})}var G=r(34);function W(e){var t=e.proposal,r=t.snapshotDraft,n=t.refetchProposalOrDraft,s=Object(f.useState)(),c=Object(h.a)(s,2),u=c[0],d=c[1],b=Object(x.c)((function(e){return e.contracts})),m=Object(x.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),D=Object(w.f)(),F=D.account,k=D.web3Instance,S=Object(w.a)(),E=S.txEtherscanURL,C=S.txIsPromptOpen,L=S.txSend,R=S.txStatus,_=Object(N.e)(),W=_.isDisabled,T=_.openWhyDisabledModal,U=_.WhyDisabledModal,V=Object(i.g)(),z=V.proposalSignAndSendStatus,B=V.signAndSendProposal,J=Object(w.b)(),Y=R===o.e.AWAITING_CONFIRM||R===o.e.PENDING||z===o.e.AWAITING_CONFIRM||z===o.e.PENDING,q=R===o.e.FULFILLED&&z===o.e.FULFILLED,H=Y||q||C;function K(){return(K=Object(O.a)(p.a.mark((function e(){var t,a,s,c,o,i,u,l,O,h,f,x,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,m){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(r){e.next=5;break}throw new Error("No Snapshot draft was found.");case 5:return t=Object(g.e)(r.actionId,b),a=r.msg,s=a.payload,c=s.name,o=s.body,i=s.metadata,u=a.timestamp,e.next=9,B({partialProposalData:{name:c,body:o,metadata:i,timestamp:u},adapterAddress:t.contractAddress,type:M.SnapshotType.proposal});case 9:return l=e.sent,O=l.data,h=l.signature,f=Object(M.prepareVoteProposalData)({payload:{name:O.payload.name,body:O.payload.body,choices:O.payload.choices,snapshot:O.payload.snapshot.toString(),start:O.payload.start,end:O.payload.end},sig:h,space:O.space,timestamp:parseInt(O.timestamp)},k),x=[m,r.idInDAO].concat(Object(G.a)(i.submitActionArgs||[]),[f]),v=Object(j.a)({from:F||""},J?{gasPrice:J.fast}:null),e.next=17,L("submitProposal",t.instance.methods,x,v);case 17:n(),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),d(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:W||H,onClick:W||H?function(){}:function(){return K.apply(this,arguments)},children:Y?Object(a.jsx)(A.a,{}):q?"Done":"Sponsor"}),Object(a.jsx)(l.a,{error:u,renderText:"Something went wrong"}),H&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){if(R===o.e.AWAITING_CONFIRM||z===o.e.AWAITING_CONFIRM)return"Awaiting your confirmation\u2026";switch(R){case o.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(I.a,{intervalMs:2e3,messages:v.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(P.a,{children:e},e)}}),Object(a.jsx)(y.a,{url:E,isPending:!0})]});case o.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Proposal submitted!"}),Object(a.jsx)(y.a,{url:E})]});default:return null}}()}),W&&Object(a.jsx)("button",{className:"button--help-centered",onClick:T,children:"Why is sponsoring disabled?"})]}),Object(a.jsx)(U,{title:"Why is sponsoring disabled?"})]})}function T(e){var t=e.adapterName,r=e.proposal,b=e.renderAction,p=Object(i.c)(r),j=p.daoProposalVoteResult,O=p.daoProposalVotes,h=p.proposalFlowStatusError,f=p.status,x=O&&f===c.c.OffchainVotingGracePeriod?1e3*Number(O.gracePeriodStartingTime):0,m=t===o.a.distribute&&f===c.c.Completed&&j&&d.a[j]===d.a[d.a.PASS],g=b&&b(Object(n.a)({},u.c.OffchainVotingContract,{adapterName:t,daoProposalVoteResult:j,daoProposalVotes:O,gracePeriodStartMs:x,proposal:r,status:f}));return Object(a.jsxs)(a.Fragment,{children:[(f===c.c.OffchainVoting||f===c.c.OffchainVotingSubmitResult||f===c.c.OffchainVotingGracePeriod||f===c.c.Process||f===c.c.Completed)&&Object(a.jsx)(s.c,{countdownGracePeriodStartMs:x,proposal:r}),Object(a.jsx)("div",{className:"proposaldetails__button-container",children:g||(f===c.c.Submit?Object(a.jsx)(W,{proposal:r}):f===c.c.Sponsor?Object(a.jsx)(_,{proposal:r}):f===c.c.OffchainVoting?Object(a.jsx)(s.b,{adapterName:t,proposal:r}):f===c.c.OffchainVotingSubmitResult?Object(a.jsx)(s.a,{adapterName:t,proposal:r}):f===c.c.Process||f===c.c.OffchainVotingGracePeriod?function(){switch(t){case o.a.onboarding:return Object(a.jsx)(E,{disabled:f===c.c.OffchainVotingGracePeriod,proposal:r,isProposalPassed:!(!j||d.a[j]!==d.a[d.a.PASS])});case o.a.tribute:return Object(a.jsx)(R,{disabled:f===c.c.OffchainVotingGracePeriod,proposal:r,isProposalPassed:!(!j||d.a[j]!==d.a[d.a.PASS])});default:return Object(a.jsx)(k,{disabled:f===c.c.OffchainVotingGracePeriod,proposal:r})}}():m?Object(a.jsx)(D,{adapterName:t,proposal:r}):void 0)}),Object(a.jsx)(l.a,{error:h,renderText:"Something went wrong while getting the proposal's status"})]})}}}]);
//# sourceMappingURL=6.2b7ab371.chunk.js.map